source:
  format: "xml"
  schema: "http://www.loc.gov/MARC21/slim http://www.loc.gov/standards/marcxml/schema/MARC21slim.xsd"
entities:  
  agent_person:
    xpath: ["//datafield[@tag='600'][@ind1='1']"]
    properties:
      agent_type:
        default: agent_person
  
      names:
        axis: self

  name_person:
    xpath: ["//datafield[@tag='600'][@ind1='1']"]
    properties:
      rules:
        default: local
  
      primary_name: 
        xpath: ["subfield[@code='a']"]
        procedure: "|val| val.sub(/,\\s.*$/, '')"
        
      rest_of_name:
        xpath: ["subfield[@code='a']"]
        procedure: "|val| val.sub(/^.*,\\s/, '')"
        
      name_order:
        default: direct
        
      number:
        xpath: ["subfield[@code='b']"]
        
      prefix:
        xpath: ["subfield[@code='c']"]
        procedure: "|val| val.sub(/,\\s.*$/, '')"
        
      title:
        xpath: ["subfield[@code='c']"]
        procedure: "|val| val.sub(/^[^,]*,\\s/, '').sub(/,\\s.*$/, '')"
        
      suffix:
        xpath: ["subfield[@code='c']"]
        procedure: "|val| val.sub(/^.*,\\s/, '')"
        
      dates:
        xpath: ["subfield[@code='d']"]
        
      fuller_form:
        xpath: ["subfield[@code='q']"]
        
      qualifier:
        xpath: ["subfield[@code='g']"]
        
      # TODO: Fix this once importerer is adding dynamic enums
      source:
        # xpath: ["subfield[@code='2']"]
        default: local
      
  agent_family:
    xpath: ["//datafield[@tag='600'][@ind1='3']"]
    properties:
      agent_type:
        default: agent_family
  
      names:
        axis: self
  
  name_family:
    xpath: ["//datafield[@tag='600'][@ind1='3']"]
    properties:
      rules:
        default: local
  
      family_name: 
        xpath: ["subfield[@code='a']"]  
  
      prefix:
        xpath: ["subfield[@code='c']"]
      
      qualifier:
        xpath: ["subfield[@code='g']"]
  
      # TODO: Fix this once importerer is adding dynamic enums
      source:
        # xpath: ["subfield[@code='2']"]
        default: local  
     
  agent_corporate_entity:
    xpath: ["//datafield[@tag='610']"]
    properties:
      agent_type:
        default: agent_corporate_entity

      names:
        axis: self
        
  name_corporate_entity:
    xpath: ["//datafield[@tag='610']"]
    properties:
      
      primary_name:
        xpath: ["subfield[@code='a']"]
        
      subordinate_name_1:
        xpath: ["subfield[@code='b']"]
        
      subordinate_name_2:
        xpath: ["subfield[@code='c']"]
        
      number:
        xpath: ["subfield[@code='n']"]
    
      qualifier:
        xpath: ["subfield[@code='g']"]
  
      # TODO: Fix this once importerer is adding dynamic enums
      source:
        # xpath: ["subfield[@code='2']"]
        default: local
  
  subject_uniform:
    record_type: subject
    xpath: ["//datafield[@tag='630']"]
    properties:
      vocabulary: 
        default: "/vocabularies/1"
        
      #TODO: etc. etc.
      source:
        # xpath: ["subfield[@code='2']"]
        default: local
      
      terms:
        xpath: ["subfield[@code='a']"]
        procedure: "|val| val.split(/--/).map {|t| {'term' => t, 'term_type' => 'uniform_title', 'vocabulary' => '/vocabularies/1'}}"
 
  subject_topical:
    record_type: subject
    xpath: ["//datafield[@tag='650']"]
    properties:
      vocabulary: 
        default: "/vocabularies/1"

      #TODO: etc. etc.
      source:
        # xpath: ["subfield[@code='2']"]
        default: local

      terms:
        xpath: ["subfield[@code='a']"]
        procedure: "|val| val.split(/--/).map {|t| {'term' => t, 'term_type' => 'topical', 'vocabulary' => '/vocabularies/1'}}"

  subject_geo:
    record_type: subject
    xpath: ["//datafield[@tag='651']"]
    properties:
      vocabulary: 
        default: "/vocabularies/1"

      #TODO: etc. etc.
      source:
        # xpath: ["subfield[@code='2']"]
        default: local

      terms:
        xpath: ["subfield[@code='a']"]
        procedure: "|val| val.split(/--/).map {|t| {'term' => t, 'term_type' => 'geographic', 'vocabulary' => '/vocabularies/1'}}"

  subject_genre:
    record_type: subject
    xpath: ["//datafield[@tag='655']"]
    properties:
      vocabulary: 
        default: "/vocabularies/1"

      #TODO: etc. etc.
      source:
        # xpath: ["subfield[@code='2']"]
        default: local

      terms:
        xpath: ["subfield[@code='a']"]
        procedure: "|val| val.split(/--/).map {|t| {'term' => t, 'term_type' => 'genre_form', 'vocabulary' => '/vocabularies/1'}}"

  subject_occupation:
    record_type: subject
    xpath: ["//datafield[@tag='656']"]
    properties:
      vocabulary: 
        default: "/vocabularies/1"

      #TODO: etc. etc.
      source:
        # xpath: ["subfield[@code='2']"]
        default: local

      terms:
        xpath: ["subfield[@code='a']"]
        procedure: "|val| val.split(/--/).map {|t| {'term' => t, 'term_type' => 'occupation', 'vocabulary' => '/vocabularies/1'}}"

  subject_function:
    record_type: subject
    xpath: ["//datafield[@tag='657']"]
    properties:
      vocabulary: 
        default: "/vocabularies/1"

      #TODO: etc. etc.
      source:
        # xpath: ["subfield[@code='2']"]
        default: local

      terms:
        xpath: ["subfield[@code='a']"]
        procedure: "|val| val.split(/--/).map {|t| {'term' => t, 'term_type' => 'function', 'vocabulary' => '/vocabularies/1'}}"

# Additional Agent / Name Records From 7** Fields:
  
  agent_family_700:
    record_type: agent_family
    xpath: ["//datafield[@tag='700'][@ind1='3']"]
    properties:
      agent_type:
        default: agent_family
  
      names:
        axis: self
        
      _role:
        force: true
        xpath: ["subfield[@code='e']"]
  
  name_family_700:
    record_type: name_family
    xpath: ["//datafield[@tag='700'][@ind1='3']"]
    properties:
      rules:
        default: local
  
      family_name: 
        xpath: ["subfield[@code='a']"]  
  
      prefix:
        xpath: ["subfield[@code='c']"]
      
      qualifier:
        xpath: ["subfield[@code='g']"]
  
      source:
        default: local

  agent_person_700:
    record_type: agent_person
    xpath: ["//datafield[@tag='700'][@ind1='1']"]
    properties:
      agent_type:
        default: agent_person

      names:
        axis: self
        
      _role:
        force: true
        xpath: ["subfield[@code='e']"]

  name_person_700:
    record_type: name_person
    xpath: ["//datafield[@tag='700'][@ind1='1']"]
    properties:
      rules:
        default: local

      primary_name: 
        xpath: ["subfield[@code='a']"]
        procedure: "|val| val.sub(/,\\s.*$/, '')"

      rest_of_name:
        xpath: ["subfield[@code='a']"]
        procedure: "|val| val.sub(/^.*,\\s/, '')"

      name_order:
        default: direct

      number:
        xpath: ["subfield[@code='b']"]

      prefix:
        xpath: ["subfield[@code='c']"]
        procedure: "|val| val.sub(/,\\s.*$/, '')"

      title:
        xpath: ["subfield[@code='c']"]
        procedure: "|val| val.sub(/^[^,]*,\\s/, '').sub(/,\\s.*$/, '')"

      suffix:
        xpath: ["subfield[@code='c']"]
        procedure: "|val| val.sub(/^.*,\\s/, '')"

      dates:
        xpath: ["subfield[@code='d']"]

      fuller_form:
        xpath: ["subfield[@code='q']"]

      qualifier:
        xpath: ["subfield[@code='g']"]

      source:
        default: local

  agent_corporate_entity_710:
    record_type: agent_corporate_entity 
    xpath: ["//datafield[@tag='710']"]
    properties:
      agent_type:
        default: agent_corporate_entity

      names:
        axis: self
      
      _role:
        force: true
        xpath: ["subfield[@code='e']"]

  name_corporate_entity_710:
    record_type: name_corporate_entity
    xpath: ["//datafield[@tag='710']"]
    properties:

      primary_name:
        xpath: ["subfield[@code='a']"]

      subordinate_name_1:
        xpath: ["subfield[@code='b']"]

      # oh boy
      # https://github.com/hudmol/archivesspace/issues/262
      # subordinate_name_2:
      #   xpath: ["subfield[@code='b']"]

      number:
        xpath: ["subfield[@code='n']"]

      qualifier:
        xpath: ["subfield[@code='g']"]

      # TODO: Fix this once importerer is adding dynamic enums
      source:
        # xpath: ["subfield[@code='2']"]
        default: local  

